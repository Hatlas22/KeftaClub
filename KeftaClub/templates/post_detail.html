{% load static %}
<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'favicon.png' %}" rel="icon" type="image/png">
    <title>Home</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'assets/css/icons.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/uikit.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/tailwind.css' %}">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<body>    
</head>
<header>
    <div class="header_inner">
        
                
        <div class="right-side lg:pr-4">
                     <!-- upload -->
                   

                
    



            <a href="#" class="header-links-item">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet"
                    viewBox="0 0 24 24">
                    <g fill="none">
                        <path
                            d="M12 22a2.02 2.02 0 0 1-2.01-2h4a2.02 2.02 0 0 1-.15.78a2.042 2.042 0 0 1-1.44 1.18h-.047A1.922 1.922 0 0 1 12 22zm8-3H4v-2l2-1v-5.5a8.065 8.065 0 0 1 .924-4.06A4.654 4.654 0 0 1 10 4.18V2h4v2.18c2.579.614 4 2.858 4 6.32V16l2 1v2z"
                            fill="currentColor" />
                    </g>
                </svg>
            </a>
            <div uk-drop="mode: click;offset: 4" class="header_dropdown">
                <h4 class="-mt-5 -mx-5 bg-gradient-to-t from-gray-100 to-gray-50 border-b font-bold px-6 py-3">
                    Notification </h4>
                <ul class="dropdown_scrollbar" data-simplebar>
                    {%if followers %}
                    {% for follower in followers %}
                    <li>
                        <a href="/profile/{{follower.user.username}}">
                            <div class="drop_avatar">
                                <img src="{{ follower.profileimg.url }}" alt="">
                            </div>
                            <div class="drop_content">
                                <p>
                                    <strong class="text-link">{{ follower.user.username}}</strong>
                                    <span class="text-link"> is following you </span>
                                </p>
                                <!--<span class="time-ago"> 2 hours ago </span>-->
                            </div>
                        </a>
                    </li>
                    {% endfor %}
                    {% else %}
                    <li>No followers yet</li>
                    {% endif %}
                </ul>
                <a href="#" class="see-all">See all</a>
            </div>
            <a href="#" class="header-links-item">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    aria-hidden="true" role="img" width="0.5em" height="0.5em" preserveAspectRatio="xMidYMid meet"
                    viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
            </a>
            <div uk-drop="mode: click;offset: 4" class="header_dropdown">
                <h4 class="-mt-5 -mx-5 bg-gradient-to-t from-gray-100 to-gray-50 border-b font-bold px-6 py-3">
                    Like </h4>
                <ul class="dropdown_scrollbar" data-simplebar>
                    {%if person_who_liked_post %}
                    {% for liker in person_who_liked_post %}
                    <li>
                        <a href="/profile/{{liker.username}}">
                            <div class="drop_avatar">
                                <img src="{{ liker.profile_pic.url }}" alt="">
                            </div>
                            <div class="drop_content">
                                <p>
                                    <strong class="text-link">{{liker.username}}</strong>
                                    <span class="text-link"> liked your post </span>
                                </p>
                                <!--<span class="time-ago"> 2 hours ago </span>-->
                            </div>
                        </a>
                    </li>
                    {% endfor %}
                    {% else %}
                    <li>No like yet</li>
                    {% endif %}
                </ul>
                <a href="#" class="see-all">See all</a>
            </div>



          
            <div uk-drop="mode: click;offset: 4" class="header_dropdown">
                <div class="msg-notif-head">
                <h4 class="-mt-5 -mx-5 bg-gradient-to-t from-gray-100 to-gray-50 border-b font-bold px-6 py-3"> Messages </h4>
                <ul class="dropdown_scrollbar" data-simplebar>
                    
                

        </div>
    </div>


    <a href="#">
        <img src="{{user_profile.profileimg.url}}" class="header-avatar" alt="">
    </a>
    <div uk-drop="mode: click;offset:9" class="header_dropdown profile_dropdown border-t">
        <ul>
            <li><a href="/profile/{{user_profile.user.username}}"> Profile </a> </li>
            <li><a href="/inbox"> Message </a> </li>
            <li><a href="/settings"> Account setting </a> </li>
            <li><a href="/signin"> Log Out</a></li>
        </ul>
    </div>
</div>
</header>
</body>
</html>
    <a href="/"><h2>Back to feed</h2></a>


    <div class="container m-auto">

        <!--<h1 class="lg:text-2xl text-lg font-extrabold leading-none text-gray-900 tracking-tight mb-5"> Feed </h1>--->

        <div class="lg:flex justify-center lg:space-x-10 lg:space-y-0 space-y-5">

            <!-- left sidebar-->
            <div class="space-y-5 flex-shrink-0 lg:w-7/12">

                <!-- post 1-->
                <div class="bg-white shadow rounded-md  -mx-2 lg:mx-0">

                    <!-- post header-->
                    <div class="flex justify-between items-center px-4 py-3">
                        <div class="flex flex-1 items-center space-x-4">
                            <!-- <a href="#">
                                <div class="bg-gradient-to-tr from-yellow-600 to-pink-600 p-0.5 rounded-full">  
                                    <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" class="bg-gray-200 border border-white rounded-full w-8 h-8">
                                </div>
                            </a> -->
                            <span class="block font-semibold "><a
                                    href="/profile/{{post.user}}">@{{post.user}}</a></span>
                        </div>
                        <div>
                            <a href="#"> <i
                                    class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 "></i>
                            </a>
                            <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100  "
                                uk-drop="mode: hover;pos: top-right">

                                <ul class="space-y-1">
                                     <li> 
                                  <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                   <i class="uil-share-alt mr-1"></i> Share
                                  </a> 
                              </li> 
                                
                                     <li> 
                                  <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                   <i class="uil-comment-slash mr-1"></i>   Disable comments
                                  </a> 
                              </li> 
                            
                                     <li>
                                <hr class="-mx-2 my-2 ">
                              </li> 
                              <li> 
                                  
                                   {% if post.user == request.user.username %}
                                        <i class="uil-trash-alt mr-1"></i> <button class="delete-post" data-id="{{ post.id }}">Delete Post</button>
                                   {% endif %}
                                   
                              </li>
                            </ul>

                            </div>
                        </div>
                    </div>

                    <div uk-lightbox>
                        <a href="/post/{{post.id}}">
                            <img src="{{post.image.url}}" alt="">
                        </a>
                    </div>


                    <div class="py-3 px-4 space-y-3">

                        <div class="flex space-x-4 lg:font-bold">
                            <a href="/like-post?post_id={{post.id}}" class="flex items-center space-x-2">
                                <div class="p-2 rounded-full text-black">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                        width="25" height="25" class="">
                                        <path
                                            d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
                                    </svg>
                                    {% if post.no_of_likes == 0 %}
                                    <p>No likes</p>
                                    {% elif post.no_of_likes == 1 %}
                                    <p>Liked by {{post.no_of_likes}} person</p>
                                    {% else %}
                                    <p>Liked by {{post.no_of_likes}} people</p>
                                    {% endif %}
                                </div>

                            </a>
                            <!-- <a href="#" class="flex items-center space-x-2">
                                <div class="p-2 rounded-full text-black">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="25" height="25" class="">
                                        <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                
                            </a> -->
                            <a href="{{post.image.url}}" class="flex items-center space-x-2 flex-1 justify-end"
                                download>
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                    aria-hidden="true" role="img" width="25" height="25"
                                    preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16">
                                    <g fill="currentColor">
                                        <path
                                            d="M8.5 1.5A1.5 1.5 0 0 1 10 0h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h6c-.314.418-.5.937-.5 1.5v6h-2a.5.5 0 0 0-.354.854l2.5 2.5a.5.5 0 0 0 .708 0l2.5-2.5A.5.5 0 0 0 10.5 7.5h-2v-6z" />
                                    </g>
                                </svg>

                            </a>
                        </div>
                        <!-- <div class="flex items-center space-x-3"> 
                            <div class="flex items-center">
                                <img src="{% static 'assets/images/avatars/avatar-1.jpg' %}" alt="" class="w-6 h-6 rounded-full border-2 border-white ">
                                <img src="{% static 'assets/images/avatars/avatar-4.jpg' %}" alt="" class="w-6 h-6 rounded-full border-2 border-white  -ml-2">
                                <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" alt="" class="w-6 h-6 rounded-full border-2 border-white  -ml-2">
                            </div>
                            <div class="">
                                Liked <strong> taiye</strong> and <strong> 209 Others </strong>
                            </div>
                        </div> -->

                        <p>
                            <a href="/profile/{{post.user}}"><strong>{{post.user}}</strong></a> {{post.caption}}
                        </p>

                        {% block content %}
                        <div class="container">
                            <div class="row">
                                <div class="col-md-8 card mb-4 mt-3 left top">
                                    <div class="card-body">
                                        <h1>{% block title %} {{ post.title }} {% endblock title %}</h1>
                                        <p class="text-muted">{{ post.author }} | {{ post.created_on }}</p>
                                        <p class="card-text">{{ post.content | safe }}</p>
                                    </div>
                                </div>
                                <div class="col-md-8 card mb-4 mt-3">
                                    <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                        <!-- comments -->
                                        <h2>{{ comments.count }} comments</h2>
                                        <div id="comments">
                                            {% for comment in comments %}
                                            <div id="comment-{{ comment.pk }}" class="comments" style="padding: 10px;">
                                                <p><strong>{{ comment.username }}</strong>: <span class="comment-body">{{ comment.body | linebreaks }}</span></p>
                                                <p><em>{{ comment.created_on }}</em></p>
                                                {% if comment.username == request.user.username %}
                                                    <button class="edit-comment" data-id="{{ comment.pk }}">Edit</button>
                                                    <button class="delete-comment" data-id="{{ comment.pk }}">Delete</button>
                                                {% endif %}
                                            </div>
                                            {% empty %}
                                            <p>No comments yet.</p>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="container">
                            <div class="row">
                                <div class="col-md-8">
                                    <h3>Leave a comment</h3>
                                    <div class="send-message">
                                        <form id="comment-form" method="POST" action="{% url 'post_detail' post.pk %}" style="margin-top: 0.5em;" class="card col-md-12 p-3 shadow-sm">
                                            {{ comment_form.as_table }}
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-primary btn-lg">Submit</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- jQuery et AJAX pour éditer et supprimer des commentaires -->
                        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                        <script>
                        $(document).ready(function() {
                            // Handle edit comment
                            $('.edit-comment').click(function() {
                                var commentId = $(this).data('id');
                                var commentBody = prompt("Edit your comment:");
                                if (commentBody) {
                                    $.ajax({
                                        url: '/comment/' + commentId + '/edit/',
                                        type: 'POST',
                                        data: {
                                            body: commentBody,
                                            csrfmiddlewaretoken: '{{ csrf_token }}'
                                        },
                                        success: function(response) {
                                            if (response.success) {
                                                // Supprimer l'ancien commentaire du DOM
                                                $('#comment-' + commentId).remove();
                                                // Ajouter le nouveau commentaire édité
                                                $('#comments').append(
                                                    '<div id="comment-' + response.comment_id + '" class="comments" style="padding: 10px;">' +
                                                    '<p><strong>' + response.username + '</strong>: <span class="comment-body">' + response.body + '</span></p>' +
                                                    '<p><em>' + response.created_on + '</em></p>' +
                                                    '<button class="edit-comment" data-id="' + response.comment_id + '">Edit</button>' +
                                                    '<button class="delete-comment" data-id="' + response.comment_id + '">Delete</button>' +
                                                    '</div>',
                                                    location.reload()
                                                );
                                            } else {
                                                alert(response.error);
                                            }
                                        }
                                    });
                                }
                            });

                            // Handle delete comment
                            $('.delete-comment').click(function() {
                                var commentId = $(this).data('id');
                                if (confirm("Are you sure you want to delete this comment?")) {
                                    $.ajax({
                                        url: '/comment/' + commentId + '/delete/',
                                        type: 'POST',
                                        data: {
                                            csrfmiddlewaretoken: '{{ csrf_token }}'
                                        },
                                        success: function(response) {
                                            if (response.success) {
                                                $('#comment-' + commentId).remove();
                                            } else {
                                                alert(response.error);
                                            }
                                        }
                                    });
                                }
                            });
                            $(document).ready(function() {
                            
                            // Handle delete post
                            $('.delete-post').click(function() {
                                var postId = $(this).data('id');
                                if (confirm("Are you sure you want to delete this post?")) {
                                    $.ajax({
                                        url: '/post/' + postId + '/delete/',
                                        type: 'POST',
                                        data: {
                                            csrfmiddlewaretoken: '{{ csrf_token }}'
                                        },
                                        success: function(response) {
                                            if (response.success) {
                                                alert("Post deleted successfully.");
                                                window.location.href = "/profile/{{user_profile.user.username}}"; // Redirigez vers la page d'accueil ou une autre page après la suppression
                                            } else {
                                                alert(response.error);
                                            }
                                        },
                                        error: function(xhr, status, error) {
                                            alert("An error occurred: " + error);
                                        }
                                    });
                                }
                            });
                        });

                            // Handle add comment
                            $('#comment-form').submit(function(event) {
                                event.preventDefault();
                                $.ajax({
                                    url: $(this).attr('action'),
                                    type: 'POST',
                                    data: $(this).serialize(),
                                    success: function(response) {
                                        if (response.success) {
                                            $('#comments').append(
                                                '<div id="comment-' + response.comment_id + '" class="comments" style="padding: 10px;">' +
                                                '<p><strong>' + response.username + '</strong>: <span class="comment-body">' + response.body + '</span></p>' +
                                                '<p><em>' + response.created_on + '</em></p>' +
                                                '<button class="edit-comment" data-id="' + response.comment_id + '">Edit</button>' +
                                                '<button class="delete-comment" data-id="' + response.comment_id + '">Delete</button>' +
                                                '</div>',
                                                location.reload()
                                            );
                                        } else {
                                            alert(response.error);
                                        }
                                    }
                                });
                            });
                        });
                        </script>
                        {% endblock content %}




                    </div>

                </div>




            </div>

        </div>


    </div>

    </div>

    </div>








    <!-- Scripts
================================================== -->
    <script src="{% static 'assets/js/tippy.all.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'assets/js/uikit.js' %}"></script>
    <script src="{% static 'assets/js/simplebar.js' %}"></script>
    <script src="{% static 'assets/js/custom.js' %}"></script>


    <script src="{% static '../../unpkg.com/ionicons%405.2.3/dist/ionicons.js' %}"></script>
</body>


</html>